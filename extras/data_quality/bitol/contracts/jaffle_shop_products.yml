dataContractSpecification: 0.9.2
id: jaffle_shop_products
info:
  title: Jaffle Shop Products
  version: 1.0.0
  description: |
    Product catalog from the jaffle_shop ERP system.

    **Deterministic Evolution:**
    - Baseline state: 20 products (IDs 1-20)
    - Day 1 delta: No changes
    - Day 2 delta: Price updates only (no row count change)
    - Day 3 delta: No changes

    **Patterns:**
    - Static catalog - no inserts after baseline
    - Price updates only
    - Price updates tracked via `updated_at`
    - Soft deletes via `deleted_at` timestamp
  owner: ERP System Team
  contact:
    name: Data Platform Team
    email: data-platform@example.com

servers:
  duckdb:
    type: duckdb
    location: data/ingestion_simulator.duckdb
    schema: jaffle_shop
    table: products
  databricks:
    type: databricks
    host: ${DATABRICKS_SERVER_HOSTNAME}
    catalog: ${DATABRICKS_CATALOG}
    schema: erp
    table: products

models:
  products:
    description: Product catalog with pricing and categories
    type: table
    fields:
      product_id:
        type: integer
        required: true
        unique: true
        primary: true
        description: Unique product identifier

      product_name:
        type: varchar
        required: true
        description: Product display name
        example: "Blueberry Muffin"

      category:
        type: varchar
        required: false
        description: Product category
        enum:
          - Bakery
          - Beverage
          - Sandwich
        example: "Bakery"

      price:
        type: decimal
        required: true
        description: Current product price in USD
        precision: 10
        scale: 2
        minValue: 0.00
        example: "3.99"

      created_at:
        type: timestamp
        required: true
        description: Record creation timestamp

      updated_at:
        type: timestamp
        required: true
        description: Record last update timestamp (changes when price updated)

      deleted_at:
        type: timestamp
        required: false
        description: Soft delete timestamp (NULL = active, non-NULL = archived)

quality:
  type: SodaCL
  specification: |
    checks for products:
      # Row count validation (static catalog, could grow)
      - row_count >= 20

      # Primary key validation
      - missing_count(product_id) = 0
      - duplicate_count(product_id) = 0

      # Required fields
      - missing_count(product_name) = 0
      - missing_count(price) = 0
      - missing_count(created_at) = 0
      - missing_count(updated_at) = 0

      # Category validation
      - invalid_count(category) = 0:
          valid values: ['Bakery', 'Beverage', 'Sandwich']

      # Price validation
      - min(price) >= 0.00

      # Audit columns validation
      - missing_count(created_at) = 0
      - missing_count(updated_at) = 0

      # No soft deletes in baseline
      - missing_count(deleted_at) = 5

examples:
  - type: csv
    model: products
    data: |
      product_id,product_name,category,price,created_at,updated_at,deleted_at
      1,"Blueberry Muffin","Bakery",3.99,2024-01-15 08:00:00,2024-01-15 08:00:00,
      2,"Chocolate Chip Cookie","Bakery",2.50,2024-01-15 08:00:00,2024-01-15 08:00:00,
      3,"Espresso","Beverage",8.99,2024-01-15 08:00:00,2024-02-16 14:30:00,
      4,"Turkey Sandwich","Sandwich",7.99,2024-01-15 08:00:00,2024-01-15 08:00:00,
      5,"Orange Juice","Beverage",4.50,2024-01-15 08:00:00,2024-01-15 08:00:00,

tags:
  - source-system
  - erp
  - jaffle-shop
  - products
  - deterministic
