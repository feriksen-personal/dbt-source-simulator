# Soda Scan: Day 1 Delta Validation (Integration Test)
#
# Validates that origin_apply_delta --args '{day: 1}' applied changes correctly.
# This is a deterministic integration test with exact row counts.
#
# Expected changes from baseline:
# - jaffle_shop.customers: +25 rows (IDs 101-125)
# - jaffle_shop.products: no changes
# - jaffle_shop.orders: +60 rows (IDs 501-560)
# - jaffle_shop.order_items: +103 rows (IDs 1201-1303)
# - jaffle_shop.payments: +52 rows (IDs 1-52)
# - jaffle_crm.campaigns: no changes
# - jaffle_crm.email_activity: +40 rows (IDs 101-140)
# - jaffle_crm.web_sessions: +30 rows (IDs 151-180)
#
# Usage:
#   # After running: dbt run-operation origin_apply_delta --args '{day: 1}'
#   soda scan -d ingestion_simulator -c configuration.yml delta_day1_checks.yml

checks for jaffle_shop.customers:
  - row_count = 125  # baseline 100 + 25 new
  - missing_count(customer_id) = 0
  - duplicate_count(customer_id) = 0

checks for jaffle_shop.products:
  - row_count = 20  # unchanged

checks for jaffle_shop.orders:
  - row_count = 560  # baseline 500 + 60 new
  - missing_count(order_id) = 0
  - duplicate_count(order_id) = 0
  # Referential integrity still valid
  - values in (customer_id) must exist in jaffle_shop.customers (customer_id)

checks for jaffle_shop.order_items:
  - row_count = 1303  # baseline 1200 + 103 new
  - missing_count(order_item_id) = 0
  - duplicate_count(order_item_id) = 0
  # Referential integrity
  - values in (order_id) must exist in jaffle_shop.orders (order_id)
  - values in (product_id) must exist in jaffle_shop.products (product_id)

checks for jaffle_shop.payments:
  - row_count = 52  # baseline 0 + 52 new
  - missing_count(payment_id) = 0
  - duplicate_count(payment_id) = 0
  # Referential integrity
  - values in (order_id) must exist in jaffle_shop.orders (order_id)

checks for jaffle_crm.campaigns:
  - row_count = 5  # unchanged

checks for jaffle_crm.email_activity:
  - row_count = 140  # baseline 100 + 40 new
  - missing_count(activity_id) = 0
  - duplicate_count(activity_id) = 0
  # Referential integrity
  - values in (campaign_id) must exist in jaffle_crm.campaigns (campaign_id)

checks for jaffle_crm.web_sessions:
  - row_count = 180  # baseline 150 + 30 new
  - missing_count(session_id) = 0
  - duplicate_count(session_id) = 0
